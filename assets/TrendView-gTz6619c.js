import{_ as M,r as l,j as R,k as S,c,h as J,b as T,a,f as b,d as y,t as P,F as Y,e as q,n as j,l as G,v as X,o as d}from"./index-X1oN8EGq.js";import{F as Z}from"./FeatureSidebar-BFwIyqxP.js";const K={class:"trend-page"},Q={class:"container"},ee={class:"main-content"},te={class:"parameter-panel"},ae={class:"form-actions"},se=["disabled"],oe={key:0,class:"fas fa-spinner fa-spin"},re={class:"result-content"},ne={key:0,class:"placeholder-text"},le={key:1,class:"analysis-output"},ie={class:"output-header"},ce={class:"header-left"},de={class:"timestamp"},ue=["innerHTML"],ve={key:0,class:"feedback-section"},fe={class:"feedback-title"},pe={class:"feedback-buttons"},me={key:0,class:"feedback-comment"},ge={key:1,class:"feedback-thanks"},ye="https://api.coze.cn/v1/workflow/run",he="pat_VzpryofEjuq9PXg5bD7TFEHkuGejT7ZEXASHudYqCvRvsFYuJfONUMxGP0juY7nv",be={__name:"TrendView",setup(ke){const r=l({categoryL1:"",categoryL2:"",categoryL3:"",categoryL4:"",priceRange:"",style_features:""}),E=["风衣","汉服","牛仔裤","皮草","皮衣","时尚套装","休闲裤","休闲运动套装","秀禾服","羽绒服","Polo衫","T恤","背心","衬衫","大码上装","大码下装","短裤","短外套","防晒服","工装制服","夹克","马甲","毛呢大衣","棉裤","棉衣","牛仔衬衫","牛仔外套","皮裤","商务正装西服","设计师/潮牌男装","时尚防晒服","唐装","卫裤","卫衣","西服","西裤","休闲西服","羊毛衫","羊绒背心","羊绒开衫","羊绒衫","羊绒套衫","羽绒裤","羽绒马甲","针织衫","中老年上装","中老年套装","中老年下装","中山装"],$=["POLO衫","T恤","半身裙","背心吊带","衬衫","短外套","风衣","连衣裙","毛衣","毛针织衫","牛仔裤","派克服","皮衣","时尚防晒服","卫裤","休闲裤","羊绒衫","羽绒服","中老年女装","打底裤","大码连衣裙","大码女装","汉服","蕾丝衫/雪纺衫","马夹","毛呢外套","棉衣/棉服","抹胸","皮草","旗袍","时尚套装","唐装/中式服装裙子","唐装/中式服装上衣","卫衣/绒衫","西装","休闲运动套装","秀禾服","打底服","大码衬衫","大码牛仔裤","大衣","短裤","礼服_晚装","连体衣/裤","连体衣裤","马甲","棉裤/羽绒裤","棉衣_棉服","设计师/潮牌女装","天然皮草","卫衣_绒衫","西服","西服套装","西装裤/正装裤","羊毛衫","羊绒大衣","真丝上装"],k=l([]);R(()=>r.value.categoryL1,s=>{r.value.categoryL2="",s==="男装"?k.value=E:s==="女装"?k.value=$:k.value=[]});const f=l(!1),n=l(""),x=l(null),O=async s=>{if(!f.value)try{f.value=!0,x.value=null,n.value="正在分析中...",r.value={categoryL1:"",categoryL2:"",categoryL3:"",categoryL4:"",priceRange:"",style_features:""};const e={workflow_id:"7475255134705319987",parameters:{categoryL1:r.value.categoryL1,categoryL2:r.value.categoryL2,categoryL3:r.value.categoryL3,categoryL4:r.value.categoryL4,priceRange:r.value.priceRange,style_features:r.value.style_features},is_async:!1};console.log("发送请求:",e);const t=await fetch(ye,{method:"POST",headers:{Authorization:`Bearer ${he}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(!t.ok){const i=await t.json();throw new Error(i.message||"分析请求失败")}const o=await t.json();if(console.log("收到响应:",o),o.error)throw new Error(o.error.message||"分析过程出现错误");o.data&&(n.value=o.data,w.value&&w.value.scrollIntoView({behavior:"smooth"})),await U("trend",n.value)}catch(e){console.error("分析错误:",e),x.value=e.message,n.value=`分析失败: ${e.message}`}finally{f.value=!1}},w=l(null),N=S(()=>new Date().toLocaleString("zh-CN")),D=l(["简约","时尚","休闲"]);l(""),R(D,s=>{r.value.style_features=s.join(",")},{deep:!0});const V=()=>{if(!n.value)return;const s=new Blob([n.value],{type:"text/plain;charset=utf-8"}),e=document.createElement("a");e.href=URL.createObjectURL(s),e.download=`趋势分析报告_${new Date().toLocaleString()}.txt`,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(e.href)},W=async()=>{try{const s=window.location.href;await navigator.clipboard.writeText(s),alert("链接已复制到剪贴板")}catch(s){console.error("复制失败:",s),alert("复制链接失败,请手动复制")}},B=S(()=>{if(!n.value)return[];try{const s=typeof n.value=="string"?JSON.parse(n.value):n.value;if(!s.data)return[];const e=s.data.trimStart();return[`<div>${I(e)}</div>`]}catch(s){return console.error("处理分析结果时出错:",s),[]}});function F(s){return s.split(/## |### /gm).reduce((e,t)=>{const o=t.split(`
`).filter(u=>u.trim());if(!o.length)return e;if(t.startsWith("抖音平台")||t.startsWith("淘系平台")||t.startsWith("小红书"))return e.push({platform:o[0].trim(),categories:[]}),e;e.length===0&&e.push({platform:"平台分析",categories:[]});const i=e[e.length-1];if(t.startsWith("抖音")||t.startsWith("淘系")||t.startsWith("小红书品类")){const u={rank:o[0].trim()};o.slice(1).forEach(v=>{const m=v.trim();if(m.startsWith("- **")){const[g,...L]=m.split(/：/),z=g.replace(/^- \*\*|\*\*/g,"").trim(),H=L.join(":").trim();u[z]=H}else m.startsWith("**结论**：")&&(u.结论=m.replace("**结论**：","").trim())}),i.categories.push(u)}return e},[])}function I(s){const e=F(s);let t="";return e.forEach(({platform:o,categories:i})=>{if(!i.length)return;t+=`<h2 class="platform-title">${o}</h2>`,t+='<table class="data-table" border="1" cellspacing="0" cellpadding="0">';const u=Object.keys(i[0]).filter(v=>v!=="rank");t+="<thead><tr>",u.forEach(v=>{t+=`<th>${v}</th>`}),t+="</tr></thead>",t+="<tbody>",i.forEach(v=>{t+="<tr>",u.forEach(m=>{const g=v[m]||"—",L=typeof g=="string"&&(g.includes("%")||/^\d+[,\.]\d+$/.test(g))?"number":"";t+=`<td class="${L}">${g}</td>`}),t+="</tr>"}),t+="</tbody>",t+="</table>"}),t}const U=async(s,e)=>{try{if(!e||e.trim()===""){console.error("保存记录失败: 结果为空");return}const t=await fetch("http://localhost:3000/api/save-record",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pageType:s,categoryL1:r.value.categoryL1,categoryL2:r.value.categoryL2,priceRange:r.value.priceRange,result:e.toString()})});if(console.log("保存记录响应状态:",t.status,t.statusText),!t.ok){const i=await t.text();throw console.error("保存记录失败响应内容:",i),new Error(`保存记录失败: ${t.status}`)}const o=await t.json();console.log("记录保存成功:",o)}catch(t){console.error("保存记录出错:",t),alert(`保存记录失败: ${t.message}`)}},p=l(null),h=l(""),_=l(!1),C=s=>{p.value=s},A=async()=>{try{console.log("提交反馈:",{type:p.value,comment:h.value,pageType:"trend",timestamp:new Date().toISOString()}),await new Promise(s=>setTimeout(s,500)),_.value=!0,setTimeout(()=>{p.value=null,h.value="",_.value=!1},3e3)}catch(s){console.error("提交反馈失败:",s)}};return(s,e)=>(d(),c("div",K,[J(Z),e[12]||(e[12]=T('<div class="animated-background" data-v-2ceeee2d><div class="fashion-icon" data-v-2ceeee2d><i class="fas fa-tshirt" data-v-2ceeee2d></i></div><div class="fashion-icon" data-v-2ceeee2d><i class="fas fa-hat-cowboy" data-v-2ceeee2d></i></div><div class="fashion-icon" data-v-2ceeee2d><i class="fas fa-socks" data-v-2ceeee2d></i></div><div class="fashion-icon" data-v-2ceeee2d><i class="fas fa-shoe-prints" data-v-2ceeee2d></i></div><div class="fashion-icon" data-v-2ceeee2d><i class="fas fa-glasses" data-v-2ceeee2d></i></div></div>',1)),a("div",Q,[e[11]||(e[11]=a("header",null,[a("div",{class:"brand-name"}," PickPro—智选专家 "),a("p",{class:"subtitle animated-text"},[a("span",{class:"glowing-white-text"},"【品类趋势先知】")])],-1)),a("div",ee,[a("div",te,[e[3]||(e[3]=T('<div class="parameter-grid" data-v-2ceeee2d><div class="robot-image-container" data-v-2ceeee2d><i class="fas fa-robot robot-icon" data-v-2ceeee2d></i><div class="robot-text" data-v-2ceeee2d><p class="robot-title" data-v-2ceeee2d>PickPro</p><p class="robot-description" data-v-2ceeee2d>从Z世代消费密码到碳中和面料革命，实时捕捉全球秀场/社交媒体/竞品动态</p><p class="robot-status" data-v-2ceeee2d>AI算法正在解析超80个市场主流品类......</p></div></div></div>',1)),a("div",ae,[a("button",{type:"submit",class:"submit-btn",onClick:O,disabled:f.value},[f.value?(d(),c("i",oe)):b("",!0),y(" "+P(f.value?"分析中...":"开始分析"),1)],8,se)])]),a("div",re,[n.value?(d(),c("div",le,[a("div",ie,[a("div",ce,[e[5]||(e[5]=a("h3",null,"分析报告",-1)),a("span",de,P(N.value),1)]),a("div",{class:"action-buttons"},[a("button",{class:"action-btn",onClick:V},e[6]||(e[6]=[a("i",{class:"fas fa-download"},null,-1),y(" 导出报告 ")])),a("button",{class:"action-btn",onClick:W},e[7]||(e[7]=[a("i",{class:"fas fa-share-alt"},null,-1),y(" 分享 ")]))])]),a("div",{class:"output-content",ref_key:"outputBox",ref:w},[(d(!0),c(Y,null,q(B.value,(t,o)=>(d(),c("div",{key:o,innerHTML:t},null,8,ue))),128))],512),n.value?(d(),c("div",ve,[a("div",fe,[e[10]||(e[10]=y(" 您对分析结果的评价如何？ ")),a("div",pe,[a("button",{class:j(["feedback-btn like-btn",{active:p.value==="like"}]),onClick:e[0]||(e[0]=t=>C("like"))},e[8]||(e[8]=[a("i",{class:"fas fa-thumbs-up"},null,-1),y(" 有帮助 ")]),2),a("button",{class:j(["feedback-btn dislike-btn",{active:p.value==="dislike"}]),onClick:e[1]||(e[1]=t=>C("dislike"))},e[9]||(e[9]=[a("i",{class:"fas fa-thumbs-down"},null,-1),y(" 不满意 ")]),2)])]),p.value?(d(),c("div",me,[G(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>h.value=t),placeholder:"请告诉我们您的具体建议（选填）",rows:"2"},null,512),[[X,h.value]]),a("button",{class:"submit-comment-btn",onClick:A},"提交")])):b("",!0),_.value?(d(),c("div",ge," 感谢您的反馈！我们将不断改进分析质量。 ")):b("",!0)])):b("",!0)])):(d(),c("div",ne,e[4]||(e[4]=[a("i",{class:"fas fa-chart-pie"},null,-1),a("p",null,"请点击开始分析按钮",-1)])))])])]),e[13]||(e[13]=T('<div class="decoration-elements" data-v-2ceeee2d><div class="floating-element" style="--delay:0s;" data-v-2ceeee2d><i class="fas fa-chart-line" data-v-2ceeee2d></i></div><div class="floating-element" style="--delay:2s;" data-v-2ceeee2d><i class="fas fa-tags" data-v-2ceeee2d></i></div><div class="floating-element" style="--delay:4s;" data-v-2ceeee2d><i class="fas fa-shopping-bag" data-v-2ceeee2d></i></div></div>',1))]))}},Le=M(be,[["__scopeId","data-v-2ceeee2d"]]);export{Le as default};
